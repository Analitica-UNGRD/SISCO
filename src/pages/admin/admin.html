<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <title>Admin - Gestión de Contratistas</title>
  
  <!-- External Dependencies -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet"/>
  
  <!-- Modular Styles -->
  <link href="../../styles/sidebar.css" rel="stylesheet"/>
  <link href="styles/admin-base.css" rel="stylesheet"/>
  <link href="styles/admin-components.css" rel="stylesheet"/>
  <link href="styles/admin-responsive.css" rel="stylesheet"/>
  <link href="styles/admin-preview.css" rel="stylesheet"/>
  <link href="styles/admin-precontractual.css" rel="stylesheet"/>
  <link href="styles/admin-phase-colors.css" rel="stylesheet"/>
  
  <!-- Legacy compatibility -->
  <!-- Los archivos admin.css y admin-sectional.css ya no son necesarios, 
       su funcionalidad ha sido incorporada a los archivos de estilo modular arriba -->
  <!-- <link href="../../styles/admin.css" rel="stylesheet"/>
  <link href="../../styles/admin-sectional.css" rel="stylesheet"/> -->
</head>
<body>
  <div id="shared-sidebar"></div>

  <!-- Main Content -->
  <main class="flex-1 p-6 overflow-y-auto">
    <!-- Context Bar -->
    <div id="contextBar" class="sticky top-4 z-30 bg-white/80 backdrop-blur-md border border-gray-200 rounded-lg p-4 mb-6 shadow-sm flex items-center justify-between gap-4">
      <div class="flex items-center gap-4">
        <div class="flex items-center gap-3">
          <div class="text-sm text-gray-500">Persona</div>
          <div id="ctxPersona" class="bg-gray-50 px-3 py-2 rounded flex items-baseline gap-3">
            <div class="text-sm font-medium text-gray-800" id="ctxPersonaNombre">-</div>
            <div class="text-xs text-gray-500" id="ctxPersonaIdent">-</div>
            <div class="inline-block text-xs bg-blue-100 text-blue-800 px-2 py-0.5 rounded" id="ctxPersonaId">-</div>
          </div>
        </div>

        <div class="flex items-center gap-3">
          <div class="text-sm text-gray-500">Contrato</div>
          <div id="ctxContrato" class="bg-gray-50 px-3 py-2 rounded flex items-baseline gap-3">
            <div class="text-sm font-medium text-gray-800" id="ctxContratoNum">-</div>
            <div class="inline-block text-xs bg-indigo-100 text-indigo-800 px-2 py-0.5 rounded" id="ctxContratoId">-</div>
          </div>
        </div>
      </div>

  <div class="flex items-center gap-2 relative">
        <div class="relative">
          <button id="ctxPersonaToggle" aria-haspopup="true" aria-expanded="false" class="bg-white border px-3 py-2 rounded text-sm flex items-center gap-2">
            <span id="ctxPersonaToggleLabel">Seleccionar persona</span>
            <span class="material-icons text-base">expand_more</span>
          </button>
          
          <!-- Dropdown panel -->
          <div id="ctxPersonaDropdown" class="hidden absolute right-0 mt-2 w-80 bg-white border rounded shadow-lg z-40">
            <div class="p-2 border-b flex items-center gap-2">
              <input id="ctxPersonaSearch" placeholder="Buscar nombre o identificación" class="flex-1 p-2 border rounded" />
            </div>
            <div class="p-2 flex items-center justify-between">
              <div id="ctxPersonaCount" class="text-sm text-gray-500">Cargando...</div>
              <div class="flex items-center gap-2">
                <button id="ctxPersonaReload" class="text-sm text-green-600 hover:underline flex items-center gap-1" title="Recargar lista de personas">
                  <span class="material-icons text-sm">refresh</span>
                  <span>Recargar</span>
                </button>
                <button id="ctxPersonaLoadMore" class="text-sm text-blue-600 hover:underline">Cargar más</button>
              </div>
            </div>
            <div id="ctxPersonaList" class="max-h-64 overflow-auto p-2 space-y-1"></div>
            
            <!-- Hidden context elements (kept for structure but without duplicate IDs) -->
            <div class="hidden">
              <span data-ctx="persona-nombre" class="ctx-dropdown-placeholder"></span>
              <span data-ctx="persona-ident" class="ctx-dropdown-placeholder"></span>
              <span data-ctx="persona-id" class="ctx-dropdown-placeholder"></span>
              <span data-ctx="contrato-num" class="ctx-dropdown-placeholder"></span>
              <span data-ctx="contrato-id" class="ctx-dropdown-placeholder"></span>
            </div>
          </div>
          </div>

        <!-- Global save button for the active section -->
        <button id="navSaveButton" class="ml-3 bg-green-600 text-white px-4 py-2 rounded text-sm flex items-center gap-2 hover:bg-green-700">
          <span class="material-icons">save</span>
          <span>Guardar</span>
        </button>
      </div>

        <button id="btnResetForm" class="bg-white border px-3 py-2 rounded text-sm flex items-center gap-2">
          <span class="material-icons text-sm">refresh</span>
          <span>Limpiar</span>
        </button>
      </div>
    </div>

    <!-- Header -->
    <header class="mb-6">
      <h2 class="text-3xl font-bold text-gray-800">Panel de Administración</h2>
      <p class="text-gray-600 mt-2">Gestión completa de contratistas y procesos contractuales</p>
    </header>

    <!-- Section Navigation -->
    <div class="section-nav">
      <div class="section-nav-item active" data-section="contractual">
        <span class="material-icons">description</span>
        <span>Contractual</span>
      </div>
      <div class="section-nav-item" data-section="cuentas-cobro">
        <span class="material-icons">receipt_long</span>
        <span>Cuentas de Cobro</span>
      </div>
      <div class="section-nav-item" data-section="precontractual">
        <span class="material-icons">assignment_ind</span>
        <span>Precontractual</span>
      </div>
      <div class="section-nav-item" data-section="configuracion">
        <span class="material-icons">settings</span>
        <span>Configuración</span>
      </div>
    </div>

    <!-- Dynamic Content Container -->
    <div id="adminContent" class="admin-content">
      <!-- Content will be loaded dynamically -->
    </div>

    <!-- Preview Panel content will be loaded dynamically through components -->

    <!-- API Diagnostics Panel -->
    <div id="apiLogsPanel" class="api-logs-panel"></div>
  </main>

  <!-- Core Scripts -->
  <script type="module" src="../../lib/auth-system.js"></script>
  <script src="scripts/admin-status-badge.js"></script>
  <script type="module" src="scripts/admin-main.js"></script>
  <script type="module">
    import { renderSidebar } from '../../pages-scripts/sidebar-component.js';
    try{ renderSidebar('#shared-sidebar'); }catch(e){}
  </script>
  
  <!-- Scripts para posicionar correctamente el panel de vista previa -->
  <!-- Disabled: preview is now integrated in dual-panel layout -->
  <!-- <script src="scripts/admin-preview-position.js"></script> -->
  <script src="scripts/admin-preview-refresh.js"></script>
  
  <!-- Protección de sesión -->
  <script type="module" src="../../lib/ui.js"></script>
  <script type="module" src="../../lib/session-guard.js"></script>
  <script type="module" src="../../lib/session-indicator.js"></script>
  
  <!-- Testing Suite (Fase 3) -->
  <script src="admin-test-suite.js"></script>
  <script src="admin-performance.js"></script>
  <script src="admin-debug-panel.js"></script>
</body>
</html>
